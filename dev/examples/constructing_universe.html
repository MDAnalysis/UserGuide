


  
    
  




<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" href="../_static/logo/mda_favicon.ico">
</head>

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Constructing, modifying, and adding to a Universe &mdash; MDAnalysis User Guide  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/site.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
    <link rel="canonical" href="https://userguide.mdanalysis.org/examples/constructing_universe.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../_static/js/versions.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within MDAnalysis User Guide  documentation"
          href="../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transformations" href="transformations/README.html" />
    <link rel="prev" title="Examples" href="README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >




  




<a href="../index.html">
  
    <img src="../_static/user_guide.png" class="logo" alt="Logo"/>
</a>


  
  
  
    <div class="version">
      2.7.0-dev0
    </div>
  



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>
<div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
    <!-- <p class="caption" role="heading"></p> -->
    <ul>
        
        <li class="toctree-l1"><a class="reference internal" href="https://mdanalysis.org">MDAnalysis</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="https://docs.mdanalysis.org/stable">API docs (stable)</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="https://docs.mdanalysis.org/dev">API docs (development)</a></li>
        
        <li class="toctree-l1"><a class="reference internal" href="https://mdakits.mdanalysis.org/">MDAKits</a></li>
        
    </ul>
    
        <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="README.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quick start guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Constructing, modifying, and adding to a Universe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Creating-and-populating-a-Universe-with-water">Creating and populating a Universe with water</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Creating-a-blank-Universe">Creating a blank Universe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Adding-topology-attributes">Adding topology attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Adding-positions">Adding positions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Adding-bonds">Adding bonds</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Merging-with-a-protein">Merging with a protein</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Adding-a-new-segment">Adding a new segment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Tiling-into-a-larger-Universe">Tiling into a larger Universe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#References">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Acknowledgments">Acknowledgments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transformations/README.html">Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="other/README.html">Other</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/alignment_and_rms/README.html">Alignments and RMS fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/distances_and_contacts/README.html">Distances and contacts</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/trajectory_similarity/README.html">Trajectory similarity</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/structure/README.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/reduced_dimensions/README.html">Dimension reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/polymers_and_membranes/README.html">Polymers and membranes</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis/volumetric/README.html">Volumetric analyses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">MDAnalysis Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data structures</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../universe.html">Universe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../atomgroup.html">AtomGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../groups_of_atoms.html">Groups of atoms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../selections.html">Atom selection language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topology_system.html">The topology system</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Trajectories</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../trajectories/trajectories.html">Trajectories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trajectories/slicing_trajectories.html">Slicing trajectories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trajectories/transformations.html">On-the-fly transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units and constants</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Input/output</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reading_and_writing.html">Reading and writing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">Format overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats/guessing.html">Guessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats/auxiliary.html">Auxiliary files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats/selection_exporters.html">Selection exporters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formats/format_reference.html">Format reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#alignments-and-rms-fitting">Alignments and RMS fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#distances-and-contacts">Distances and contacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#trajectory-similarity">Trajectory similarity</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#structure">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#volumetric-analyses">Volumetric analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#dimension-reduction">Dimension reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#polymers-and-membranes">Polymers and membranes</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/README.html#hydrogen-bond-analysis">Hydrogen Bond Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/custom_trajectory_analysis.html">Writing your own trajectory analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis/custom_parallel_analysis.html">Parallelizing analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../standard_selections.html">Standard residues in MDAnalysis selections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_topology.html">Advanced topology concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets.html">Example data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing_code.html">Contributing to the main codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing_docs.html">Contributing to the user guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preparing_releases_and_hotfixes.html">Preparing a release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module_imports.html">Module imports in MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Tests in MDAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

</div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MDAnalysis User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="README.html">Examples</a></li>
      <li class="breadcrumb-item active">Constructing, modifying, and adding to a Universe</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/constructing_universe.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <script src="http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script>require=requirejs;</script><section id="Constructing,-modifying,-and-adding-to-a-Universe">
<h1>Constructing, modifying, and adding to a Universe<a class="headerlink" href="#Constructing,-modifying,-and-adding-to-a-Universe" title="Permalink to this heading"></a></h1>
<p>MDAnalysis version: ≥ 0.20.1</p>
<p><strong>Last updated:</strong> December 2022 with MDAnalysis 2.4.0-dev0</p>
<p>Sometimes you may want to construct a Universe from scratch, or add attributes that are not read from a file. For example, you may want to group a Universe into chains, or create custom segments for protein domains.</p>
<p>In this tutorial we:</p>
<ul class="simple">
<li><p>create a Universe consisting of water molecules</p></li>
<li><p>merge this with a protein Universe loaded from a file</p></li>
<li><p>create custom segments labeling protein domains</p></li>
</ul>
<p>Throughout this tutorial we will include cells for visualising Universes with the <a class="reference external" href="http://nglviewer.org/nglview/latest/api.html">NGLView</a> library. However, these will be commented out, and we will show the expected images generated instead of the interactive widgets.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">MDAnalysis</span> <span class="k">as</span> <span class="nn">mda</span>
<span class="kn">from</span> <span class="nn">MDAnalysis.tests.datafiles</span> <span class="kn">import</span> <span class="n">PDB_small</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="c1"># suppress some MDAnalysis warnings when writing PDB files</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using MDAnalysis version&quot;</span><span class="p">,</span> <span class="n">mda</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="c1"># Optionally, use NGLView to interactively view your trajectory</span>
<span class="kn">import</span> <span class="nn">nglview</span> <span class="k">as</span> <span class="nn">nv</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using NGLView version&quot;</span><span class="p">,</span> <span class="n">nv</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using MDAnalysis version 2.6.0-dev0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1177615fa88e496c827928276bc1fc63", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using NGLView version 3.0.3
</pre></div></div>
</div>
<section id="Creating-and-populating-a-Universe-with-water">
<h2>Creating and populating a Universe with water<a class="headerlink" href="#Creating-and-populating-a-Universe-with-water" title="Permalink to this heading"></a></h2>
<section id="Creating-a-blank-Universe">
<h3>Creating a blank Universe<a class="headerlink" href="#Creating-a-blank-Universe" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Universe.empty()</span></code> method creates a blank Universe. The <code class="docutils literal notranslate"><span class="pre">natoms</span></code> (int) argument must be included. Optional arguments are:</p>
<ul class="simple">
<li><p>n_residues (int): number of residues</p></li>
<li><p>n_segments (int): number of segments</p></li>
<li><p>atom_resindex (list): list of resindices for each atom</p></li>
<li><p>residue_segindex (list): list of segindices for each residue</p></li>
<li><p>trajectory (bool): whether to attach a MemoryReader trajectory (default False)</p></li>
<li><p>velocities (bool): whether to include velocities in the trajectory (default False)</p></li>
<li><p>forces (bool): whether to include forces in the trajectory (default False)</p></li>
</ul>
<p>We will create a Universe with 1000 water molecules.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_residues</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">n_atoms</span> <span class="o">=</span> <span class="n">n_residues</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1"># create resindex list</span>
<span class="n">resindices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_residues</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">resindices</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_atoms</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resindices:&quot;</span><span class="p">,</span> <span class="n">resindices</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>

<span class="c1"># all water molecules belong to 1 segment</span>
<span class="n">segindices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_residues</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;segindices:&quot;</span><span class="p">,</span> <span class="n">segindices</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
resindices: [0 0 0 1 1 1 2 2 2 3]
segindices: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the Universe</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span>
                         <span class="n">n_residues</span><span class="o">=</span><span class="n">n_residues</span><span class="p">,</span>
                         <span class="n">atom_resindex</span><span class="o">=</span><span class="n">resindices</span><span class="p">,</span>
                         <span class="n">residue_segindex</span><span class="o">=</span><span class="n">segindices</span><span class="p">,</span>
                         <span class="n">trajectory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># necessary for adding coordinates</span>
<span class="n">sol</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Universe with 3000 atoms&gt;
</pre></div></div>
</div>
</section>
<section id="Adding-topology-attributes">
<h3>Adding topology attributes<a class="headerlink" href="#Adding-topology-attributes" title="Permalink to this heading"></a></h3>
<p>There isn’t much we can do with our current Universe because MDAnalysis has no information on the particle elements, positions, etc. We can add relevant information manually using TopologyAttrs.</p>
<p><strong>names</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_residues</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;O&#39;, &#39;H1&#39;, &#39;H2&#39;, ..., &#39;O&#39;, &#39;H1&#39;, &#39;H2&#39;], dtype=object)
</pre></div></div>
</div>
<p><strong>elements (“types”)</strong></p>
<p>Elements are typically contained in the <code class="docutils literal notranslate"><span class="pre">type</span></code> topology attribute.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_residues</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">types</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;O&#39;, &#39;H&#39;, &#39;H&#39;, ..., &#39;O&#39;, &#39;H&#39;, &#39;H&#39;], dtype=object)
</pre></div></div>
</div>
<p><strong>residue names (“resnames”)</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;resname&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SOL&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">n_residues</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">resnames</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;SOL&#39;, &#39;SOL&#39;, &#39;SOL&#39;, ..., &#39;SOL&#39;, &#39;SOL&#39;, &#39;SOL&#39;], dtype=object)
</pre></div></div>
</div>
<p><strong>residue counter (“resids”)</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;resid&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_residues</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">resids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([   1,    1,    1, ..., 1000, 1000, 1000])
</pre></div></div>
</div>
<p><strong>segment/chain names (“segids”)</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;segid&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SOL&#39;</span><span class="p">])</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">segids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;SOL&#39;, &#39;SOL&#39;, &#39;SOL&#39;, ..., &#39;SOL&#39;, &#39;SOL&#39;, &#39;SOL&#39;], dtype=object)
</pre></div></div>
</div>
</section>
<section id="Adding-positions">
<h3>Adding positions<a class="headerlink" href="#Adding-positions" title="Permalink to this heading"></a></h3>
<p>Positions can simply be assigned, without adding a topology attribute.</p>
<p>The O-H bond length in water is around 0.96 Angstrom, and the bond angle is 104.45°. We can first obtain a set of coordinates for one molecule, and then translate it for every water molecule.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># coordinates obtained by building a molecule in the program IQMol</span>
<span class="n">h2o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span>      <span class="p">],</span>  <span class="c1"># oxygen</span>
                <span class="p">[</span> <span class="mf">0.95908</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02691</span><span class="p">,</span> <span class="mf">0.03231</span><span class="p">],</span>  <span class="c1"># hydrogen</span>
                <span class="p">[</span><span class="o">-</span><span class="mf">0.28004</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.58767</span><span class="p">,</span> <span class="mf">0.70556</span><span class="p">]])</span> <span class="c1"># hydrogen</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># translating h2o coordinates around a grid</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_residues</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">grid_size</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="p">((</span><span class="n">i</span> <span class="o">//</span> <span class="n">grid_size</span><span class="p">)</span> <span class="o">%</span> <span class="n">grid_size</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="p">(</span><span class="n">grid_size</span> <span class="o">*</span> <span class="n">grid_size</span><span class="p">))</span>

    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>

    <span class="n">coordinates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">h2o</span> <span class="o">+</span> <span class="n">xyz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([0., 0., 0.]), array([ 0.95908, -0.02691,  0.03231]), array([-0.28004, -0.58767,  0.70556]), array([8., 0., 0.]), array([ 8.95908, -0.02691,  0.03231]), array([ 7.71996, -0.58767,  0.70556]), array([16.,  0.,  0.]), array([16.95908, -0.02691,  0.03231]), array([15.71996, -0.58767,  0.70556]), array([24.,  0.,  0.])]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coord_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">coord_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">coord_array</span>
</pre></div>
</div>
</div>
<p>We can view the atoms with NGLView, a library for visualising molecules. It guesses bonds based on distance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sol_view = nv.show_mdanalysis(sol)</span>
<span class="c1"># sol_view.add_representation(&#39;ball+stick&#39;, selection=&#39;all&#39;)</span>
<span class="c1"># sol_view.center()</span>
<span class="c1"># sol_view</span>
</pre></div>
</div>
</div>
<center><div style="width:800px; text-align:center;"><img alt="sol_view" src="../_images/constructing-universe_sol-view.png" />
</div></center></section>
<section id="Adding-bonds">
<h3>Adding bonds<a class="headerlink" href="#Adding-bonds" title="Permalink to this heading"></a></h3>
<p>Currently, the <code class="docutils literal notranslate"><span class="pre">sol</span></code> universe doesn’t contain any bonds.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="s1">&#39;bonds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>They can be important for defining ‘fragments’, which are groups of atoms where every atom is connected by a bond to another atom in the group (i.e. what is commonly called a molecule). You can pass a list of tuples of atom indices to add bonds as a topology attribute.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bonds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">bonds</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">o</span><span class="p">,</span> <span class="n">o</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">o</span><span class="o">+</span><span class="mi">2</span><span class="p">)])</span>

<span class="n">bonds</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(0, 1),
 (0, 2),
 (3, 4),
 (3, 5),
 (6, 7),
 (6, 8),
 (9, 10),
 (9, 11),
 (12, 13),
 (12, 14)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s1">&#39;bonds&#39;</span><span class="p">,</span> <span class="n">bonds</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">bonds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;TopologyGroup containing 2000 bonds&gt;
</pre></div></div>
</div>
<p>The bonds associated with each atom or the bonds within an AtomGroup can be accessed with the <code class="docutils literal notranslate"><span class="pre">bonds</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;TopologyGroup containing 2 bonds&gt;
&lt;TopologyGroup containing 7 bonds&gt;
</pre></div></div>
</div>
</section>
</section>
<section id="Merging-with-a-protein">
<h2>Merging with a protein<a class="headerlink" href="#Merging-with-a-protein" title="Permalink to this heading"></a></h2>
<p>Now we can merge the water with a protein to create a combined system by using <code class="docutils literal notranslate"><span class="pre">MDAnalysis.Merge</span></code> to combine AtomGroup instances.</p>
<p>The protein is adenylate kinase (AdK), a phosphotransferase enzyme. <a class="reference internal" href="#References"><span class="std std-ref">[1]</span></a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">protein</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">PDB_small</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># protein_view = nv.show_mdanalysis(protein)</span>
<span class="c1"># protein_view</span>
</pre></div>
</div>
</div>
<center><div style="width:800px; text-align:center;"><img alt="protein_view" src="../_images/constructing-universe_protein-view.png" />
</div></center><p>We will translate the centers of both systems to the origin, so they can overlap in space.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cog</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">center_of_geometry</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original solvent center of geometry: &#39;</span><span class="p">,</span> <span class="n">cog</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span> <span class="o">-=</span> <span class="n">cog</span>
<span class="n">cog2</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">center_of_geometry</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New solvent center of geometry: &#39;</span><span class="p">,</span> <span class="n">cog2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original solvent center of geometry:  [36.22634681 35.79514029 36.24595657]
New solvent center of geometry:  [ 2.78155009e-07 -1.27156576e-07  3.97364299e-08]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cog</span> <span class="o">=</span> <span class="n">protein</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">center_of_geometry</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original solvent center of geometry: &#39;</span><span class="p">,</span> <span class="n">cog</span><span class="p">)</span>
<span class="n">protein</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span> <span class="o">-=</span> <span class="n">cog</span>
<span class="n">cog2</span> <span class="o">=</span> <span class="n">protein</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">center_of_geometry</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New solvent center of geometry: &#39;</span><span class="p">,</span> <span class="n">cog2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original solvent center of geometry:  [-3.66508082  9.60502842 14.33355791]
New solvent center of geometry:  [8.30580288e-08 3.49225059e-08 2.51332265e-08]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">combined</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">protein</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># combined_view = nv.show_mdanalysis(combined)</span>
<span class="c1"># combined_view.add_representation(&quot;ball+stick&quot;, selection=&quot;not protein&quot;)</span>
<span class="c1"># combined_view</span>
</pre></div>
</div>
</div>
<center><div style="width:800px; text-align:center;"><img alt="combined_view" src="../_images/constructing-universe_combined-view.png" />
</div></center><p>Unfortunately, some water molecules overlap with the protein. We can create a new AtomGroup containing only the molecules where every atom is further away than 6 angstroms from the protein.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_overlap</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s2">&quot;same resid as (not around 6 protein)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>With this AtomGroup, we can then construct a new Universe.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">no_overlap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># no_overlap_view = nv.show_mdanalysis(u)</span>
<span class="c1"># no_overlap_view.add_representation(&quot;ball+stick&quot;, selection=&quot;not protein&quot;)</span>
<span class="c1"># no_overlap_view</span>
</pre></div>
</div>
</div>
<center><div style="width:800px; text-align:center;"><img alt="no_overlap_view" src="../_images/constructing-universe_no-overlap-view.png" />
</div></center></section>
<section id="Adding-a-new-segment">
<h2>Adding a new segment<a class="headerlink" href="#Adding-a-new-segment" title="Permalink to this heading"></a></h2>
<p>Often you may want to assign atoms to a segment or chain – for example, adding segment IDs to a PDB file. This requires adding a new Segment with <code class="docutils literal notranslate"><span class="pre">Universe.add_Segment</span></code>.</p>
<p>Adenylate kinase has three domains: CORE, NMP, and LID. As shown in the picture below,<a class="reference internal" href="#References"><span class="std std-ref">[1]</span></a> these have the residues:</p>
<ul class="simple">
<li><p>CORE: residues 1-29, 60-121, 160-214 (gray)</p></li>
<li><p>NMP: residues 30-59 (blue)</p></li>
<li><p>LID: residues 122-159 (yellow)</p></li>
</ul>
<p><img alt="981773e3345a4d3d9310d77a94a472a9" src="https://github.com/MDAnalysis/MDAnalysisTutorial/blob/master/doc/sphinx/figs/angle_defs.png?raw=true" /></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">segids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;4AKE&#39;, &#39;SOL&#39;], dtype=object)
</pre></div></div>
</div>
<p>On examining the Universe, we can see that the protein and solvent are already divided into two segments: protein (‘4AKE’) and solvent (‘SOL’). We will add three more segments (CORE, NMP, and LID) and assign atoms to them.</p>
<p>First, add a Segment to the Universe with a <code class="docutils literal notranslate"><span class="pre">segid</span></code>. It will be empty:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">core_segment</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">add_Segment</span><span class="p">(</span><span class="n">segid</span><span class="o">=</span><span class="s1">&#39;CORE&#39;</span><span class="p">)</span>
<span class="n">core_segment</span><span class="o">.</span><span class="n">atoms</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AtomGroup with 0 atoms&gt;
</pre></div></div>
</div>
<p>Residues can’t be broken across segments. To put atoms in a segment, assign the segments attribute of their residues:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">core_atoms</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s1">&#39;resid 1:29 or resid 60:121 or resid 160-214&#39;</span><span class="p">)</span>
<span class="n">core_atoms</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="n">core_segment</span>
<span class="n">core_segment</span><span class="o">.</span><span class="n">atoms</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AtomGroup with 2744 atoms&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmp_segment</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">add_Segment</span><span class="p">(</span><span class="n">segid</span><span class="o">=</span><span class="s1">&#39;NMP&#39;</span><span class="p">)</span>
<span class="n">lid_segment</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">add_Segment</span><span class="p">(</span><span class="n">segid</span><span class="o">=</span><span class="s1">&#39;LID&#39;</span><span class="p">)</span>

<span class="n">nmp_atoms</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s1">&#39;resid 30:59&#39;</span><span class="p">)</span>
<span class="n">nmp_atoms</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="n">nmp_segment</span>

<span class="n">lid_atoms</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="s1">&#39;resid 122:159&#39;</span><span class="p">)</span>
<span class="n">lid_atoms</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="n">lid_segment</span>
</pre></div>
</div>
</div>
<p>As of MDAnalysis 2.1.0, PDBs use the <code class="docutils literal notranslate"><span class="pre">chainID</span></code> <code class="docutils literal notranslate"><span class="pre">TopologyAttr</span></code> for the <code class="docutils literal notranslate"><span class="pre">chainID</span></code> column. If it is missing, it uses a placeholder “X” value instead of the <code class="docutils literal notranslate"><span class="pre">segid</span></code>. We therefore must manually set that ourselves to visualise the protein in NGLView.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add the topologyattr to the universe</span>
<span class="n">u</span><span class="o">.</span><span class="n">add_TopologyAttr</span><span class="p">(</span><span class="s2">&quot;chainID&quot;</span><span class="p">)</span>
<span class="n">core_segment</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">chainIDs</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
<span class="n">nmp_segment</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">chainIDs</span> <span class="o">=</span> <span class="s2">&quot;N&quot;</span>
<span class="n">lid_segment</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">chainIDs</span> <span class="o">=</span> <span class="s2">&quot;L&quot;</span>
</pre></div>
</div>
</div>
<p>We can check that we have the correct domains by visualising the protein.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># domain_view = nv.show_mdanalysis(u)</span>
<span class="c1"># domain_view.add_representation(&quot;protein&quot;, color_scheme=&quot;chainID&quot;)</span>
<span class="c1"># domain_view</span>
</pre></div>
</div>
</div>
<center><div style="width:800px; text-align:center;"><img alt="no_overlap_view" src="../_images/constructing-universe_domain-view.png" />
</div></center></section>
<section id="Tiling-into-a-larger-Universe">
<h2>Tiling into a larger Universe<a class="headerlink" href="#Tiling-into-a-larger-Universe" title="Permalink to this heading"></a></h2>
<p>We can use MDAnalysis to tile out a smaller Universe into a bigger one, similarly to <code class="docutils literal notranslate"><span class="pre">editconf</span></code> in GROMACS. To start off, we need to figure out the box size. The default in MDAnalysis is a zero vector. The first three numbers represent the length of each axis, and the last three represent the alpha, beta, and gamma angles of a triclinic box.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
None
</pre></div></div>
</div>
<p>We know that our system is cubic in shape, so we can assume angles of 90°. The difference between the lowest and highest x-axis positions is roughly 73 Angstroms.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">max</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
73.23912
</pre></div></div>
</div>
<p>So we can set our dimensions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">73</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>To tile out a Universe, we need to copy it and translate the atoms by the box dimensions. We can then merge the cells into one large Universe and assign new dimensions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tile_universe</span><span class="p">(</span><span class="n">universe</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">n_z</span><span class="p">):</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">copied</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_y</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_z</span><span class="p">):</span>
                <span class="n">u_</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">move_by</span> <span class="o">=</span> <span class="n">box</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                <span class="n">u_</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">move_by</span><span class="p">)</span>
                <span class="n">copied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

    <span class="n">new_universe</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="o">*</span><span class="n">copied</span><span class="p">)</span>
    <span class="n">new_box</span> <span class="o">=</span> <span class="n">box</span><span class="o">*</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">n_z</span><span class="p">)</span>
    <span class="n">new_universe</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_box</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">90</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>
    <span class="k">return</span> <span class="n">new_universe</span>
</pre></div>
</div>
</div>
<p>Here is a 2 x 2 x 2 version of our original unit cell:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tiled</span> <span class="o">=</span> <span class="n">tile_universe</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tiled_view = nv.show_mdanalysis(tiled)</span>
<span class="c1"># tiled_view</span>
</pre></div>
</div>
</div>
<center><div style="width:800px; text-align:center;"><img alt="tiled_view" src="../_images/constructing-universe_tiled-view.png" />
</div></center></section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this heading"></a></h2>
<p>[1]: Beckstein O, Denning EJ, Perilla JR, Woolf TB. Zipping and unzipping of adenylate kinase: atomistic insights into the ensemble of open&lt;–&gt;closed transitions. J Mol Biol. 2009;394(1):160–176. <a class="reference external" href="https://dx.doi.org/10.1016%2Fj.jmb.2009.09.009">doi:10.1016/j.jmb.2009.09.009</a></p>
</section>
<section id="Acknowledgments">
<h2>Acknowledgments<a class="headerlink" href="#Acknowledgments" title="Permalink to this heading"></a></h2>
<p>The Universe tiling code was modified from <a class="reference external" href="https://github.com/richardjgowers">&#64;richardjgowers</a>’s <a class="reference external" href="https://gist.github.com/richardjgowers/b16b871259451e85af0bd2907d30de91">gist on the issue</a> in 2016.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="README.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transformations/README.html" class="btn btn-neutral float-right" title="Transformations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2023, Lily Wang, Irfan Alibay, Patricio Barletta, Cédric Bouysset, Jan Domanski, Bjarne Feddersen, Florent Langenfeld, Hugo MacDermott-Opeskin, Micaela Matta, Rocco Meli, Paul Smith, Mieczyslaw Torchala, Mark Verma, Yuxuan Zhuang, Richard J. Gowers, and Oliver Beckstein..</p>
  </div>

  

<div class="footer"><p>Please see
    our <a href="https://www.mdanalysis.org/pages/privacy/">Privacy Policy</a>
    to learn how <a href="https://www.mdanalysis.org">MDAnalysis</a> collects data.</p>
    <script data-goatcounter="https://mdanalysis.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</div>



</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
    var versions_json_url = 'https://userguide.mdanalysis.org/versions.json'
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>